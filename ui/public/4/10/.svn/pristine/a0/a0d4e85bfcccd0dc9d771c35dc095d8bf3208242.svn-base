[% INCLUDE _inc/_html_head %]
  <body>
    <div class="wrap lp-center panel-page">
      <div class="inner">
        <div class="wrap lp-top panel-global_head">
          <div class="inner">
            [% INCLUDE _inc/_header %]
            <ul class="capsule_list_segmented">
               <li class="first" onClick="location.href='[% C.uri_for_action('/lines/controlpoints/index') %]'"><span>Активные контрольные точки</span></li
              ><li onClick="location.href='[% C.uri_for_action('/mediaplans/index') %]'"><span>Медиапланы</span></li
              ><li class="selected" onClick="location.href='[% C.request.uri %]'"><span>Клиенты</span></li
              ><li class="last" onClick="location.href='[% C.uri_for_action('/tools/index') %]'"><span>Инструменты</span></li>
            </ul>
          </div>
        </div>
        <div class="wrap lp-top panel-global_actions">
          <form name="filter" method="get" action="[% C.uri_for_action(C.action) %]">
            <div class="inner mform">
              <input type="button" value="Добавить клиента" onClick="load_dialog('[% C.uri_for_action('/advertisers/create', [], {agency_id => filter.agency_id}) %]','d_client'); showDialog('d_client');" />
              <div class="list_settings">
                <label>Подразделение:</label>
                <select name="agency_id" onchange=javascript:document.filter.submit()>
                  [% USE String %]
                  [% FOREACH agency IN agencies.sort('title') %]
                  [% agency_id = String.new(agency.id) %]
                  <option value="[% agency.id %]" [% IF agency_id.upper == filter.agency_id %] selected="" [% END %]>[% agency.title %]</option>
                  [% END %]
                </select>
              </div>
              <div class="filter">
                <label for="selector_hide_archived">Скрыть архивных клиентов:</label>
                <input type="checkbox" id="selector_hide_archived" [% IF filter.hide_archived %] checked="" [% END %] onchange="javascript: $('hide_archived').value = $('selector_hide_archived').checked ? '1' : '0'; document.filter.submit()"/>
              </div>
            </div>
            <input id="sorted_column" type="hidden" name="sorted_column" value="[% filter.sorted_column %]"/>
            <input id="hide_archived" type="hidden" name="hide_archived" value="[% filter.hide_archived %]"/>
          </form>
        </div>

        [% MACRO def_sorted_column(column) IF filter.sorted_column == column %]class="sorted"[% END %]
        [% MACRO set_sorted_column(column) BLOCK %]javascript:$('sorted_column').value='[% column %]';document.filter.submit()[% END %]
        <div class="wrap lp-top">
          <div class="inner panel-thead">
            <table class="fixed">
              <col style="width: 20em;" [% def_sorted_column('title') %] />
              <col style="width: 25em;" [% def_sorted_column('name') %] />
              <col style="width: 20em;" [% def_sorted_column('email') %] />
              <col />
              <thead>
                <tr>
                  <td class="sortable" onclick="[% set_sorted_column('title') %]"><div class="colheader">Название</div></td>
                  <td class="sortable" onclick="[% set_sorted_column('name') %]"><div class="colheader">Контактное лицо</div></td>
                  <td class="sortable" onclick="[% set_sorted_column('email') %]"><div class="colheader">E-mail</div></td>
                  <td></td>
                </tr>
              </thead>
            </table>
          </div>
        </div>
        <div class="wrap lp-center">
          <div class="inner panel-tbody">
            <table class="fixed striped">
              <col style="width: 20em;" [% def_sorted_column('title') %] />
              <col style="width: 25em;" [% def_sorted_column('name') %] />
              <col style="width: 20em;" [% def_sorted_column('email') %] />
              <col />
              <tbody>
                [% FOREACH client IN clients.sort(filter.sorted_column) %]
                <tr [% IF client.archived %] class="inactive" [% END %]>
                  <td>[% client.title %]</td>
                  <td>[% client.name %]</td>
                  <td>[% client.email %]</td>
                  <td><div class="inline-block"><ins title="Изменить" class="sprite32bit size16x16 i16_edit clickable" onClick="load_dialog('[% C.uri_for_action('/advertisers/edit', [client.id]) %]','d_client'); showDialog('d_client');" onMouseOver="Element.addClassName(this.parentNode.parentNode.parentNode,'over'); Element.addClassName(this,'i16_edit_over');" onMouseOut="Element.removeClassName(this,'i16_edit_over');  Element.removeClassName(this.parentNode.parentNode.parentNode,'over');"><i></i></ins><ins title="Удалить" class="sprite32bit size16x16 i16_del clickable" onClick="delete_object('[% C.uri_for_action('/advertisers/delete', [client.id]) %]', 'Удалить «[% client.title %]» ?\n\n');" onMouseOver="Element.addClassName(this.parentNode.parentNode.parentNode,'over'); Element.addClassName(this,'i16_del_over');" onMouseOut="Element.removeClassName(this,'i16_del_over'); Element.removeClassName(this.parentNode.parentNode.parentNode,'over');"><i></i></ins></div></td>
                </tr>
                [% END %]
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

[% INCLUDE _inc/_dialogs %]
  </body>
</html>
