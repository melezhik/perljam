[% INCLUDE _inc/_html_head %]
  <body>
    <div class="wrap lp-center panel-page">
      <div class="inner">
        <div class="wrap lp-top panel-global_head">
          <div class="inner">
            [% INCLUDE _inc/_header %]
            <ul class="capsule_list_segmented">
               <li class="first" onClick="location.href='[% C.uri_for_action('/lines/controlpoints/index') %]'"><span>Активные контрольные точки</span></li
              ><li class="selected" onClick="location.href='[% C.request.uri %]'"><span>Медиапланы</span></li
              ><li onClick="location.href='[% C.uri_for_action('/advertisers/index') %]'"><span>Клиенты</span></li
              ><li class="last" onClick="location.href='[% C.uri_for_action('/tools/index') %]'"><span>Инструменты</span></li>
            </ul>
          </div>
        </div>
        <div class="wrap lp-top panel-global_actions">
          <form name="filter" method="get" action="[% C.uri_for_action(C.action) %]">
            <div class="inner mform">
              <input type="button" value="Добавить медиаплан" onClick="load_dialog('[% C.uri_for_action('/mediaplan/create') %]','d_mediaplan'); showDialog('d_mediaplan')" />
              <div class="list_settings">
                <label>Вид списка:</label>
                <select name="list_format" onchange="document.filter.submit();" id="list_format">
                  [% list_formats = [
                       { value = 'own', title = 'мои медиапланы' },
                       { value = 'agency', title = 'медиапланы подразделения' },
                       { value = 'all', title = 'все медиапланы' },
                       { value = 'client', title = 'медиапланы по клиентам' }
                     ]
                  %]
                  [% FOREACH format IN list_formats %]
                  <option value="[% format.value %]" [% IF format.value == 'client' AND filter.list_format != 'client' %] disabled="" [% ELSIF format.value == filter.list_format %] selected="" [% END %]>[% format.title %]</option>
                  [% END %]
                </select>
                <select class="clients" onchange="submitOnSelect(this)" id="list_clients">
                  <option class="opthint" value="">выберите клиента</option>
                  [% USE String %]
                  [% FOREACH agency IN agencies.sort('title') %]
                  [% agency_id = String.new(agency.id) %]
                  <option class="group" value="[% agency.id %]" [% IF agency_id.upper == filter.agency_id %] selected="" [% END %]>[% agency.title %]</option>
                    [% FOREACH client IN agency.clients.sort('title') %]
                    [% client_id = String.new(client.id) %]
                    <option [% IF client.archived %] class="inactive" [% END %] value="[% client.id %]" [% IF client_id.upper == filter.client_id %] selected="" [% END %]>[% client.title %]</option>
                    [% END %]
                  [% END %]
                </select>
                <input type="checkbox" id="enableArchivedCB" title="показать архивных клиентов" onclick="enableArchivedCBHandler(this.checked)"/><label for="enableArchivedCB">архивные клиенты</label>
              </div>
              <div class="filter">
                <input type="checkbox" id="selector_hide_archived" [% IF filter.hide_archived %] checked="" [% END %] onchange="javascript: $('hide_archived').value = $('selector_hide_archived').checked ? '1' : '0'; document.filter.submit()"/><label for="selector_hide_archived">Скрыть архивные медиапланы</label>
              </div>
            </div>
            <input id="agency_id" type="hidden" name="agency_id" value="[% filter.agency_id %]" />
            <input id="client_id" type="hidden" name="client_id" value="[% filter.client_id %]" />
            <input id="sorted_column" type="hidden" name="sorted_column" value="[% filter.sorted_column %]"/>
            <input id="hide_archived" type="hidden" name="hide_archived" value="[% filter.hide_archived %]"/>
            <script language="Javascript" src="/js/mediaplans.js"></script>
          </form>
        </div>
        [% UNLESS filter.defined('sorted_column');
             filter.sorted_column = 'title';
           END
        %]
        [% MACRO def_sorted_column(column) IF filter.sorted_column == column %]class="sorted"[% END %]
        [% MACRO set_sorted_column(column) BLOCK %]javascript:$('sorted_column').value='[% column %]';document.filter.submit()[% END %]
        <div class="wrap lp-center">
          <div class="inner panel-tbody">
            <table class="fixed striped">
              <col [% def_sorted_column('title') %] />
              <col style="width: 50px;" />
              <col style="width: 13em;" />
              <col style="width: 20%;" [% def_sorted_column('advertiser') %] />
              <col style="width: 20%;" [% def_sorted_column('sales_manager') %] />
              <col style="width: 20%;" [% def_sorted_column('account_manager') %] />
              <thead>
               <tr>
                 <td class="sortable" onclick="[% set_sorted_column('title') %]"><div class="colheader">Название медиаплана</div></td>
                 <td></td>
                 <td><div class="colheader">Период</div></td>
                 <td class="sortable" onclick="[% set_sorted_column('advertiser') %]"><div class="colheader">Клиент</div></td>
                 <td class="sortable" onclick="[% set_sorted_column('sales_manager') %]"><div class="colheader">Продавец</div></td>
                 <td class="sortable" onclick="[% set_sorted_column('account_manager') %]"><div class="colheader">Аккаунт-менеджер</div></td>
               </tr>
              </thead>
              <tbody>
                [% FOREACH mediaplan IN data.sort(filter.sorted_column) %]
                <tr [% IF mediaplan.status == 'archived' %] class="inactive" [% END %]>
                  <td><a href="[% C.uri_for_action('/mediaplan/index', [mediaplan.id]) %]">[% mediaplan.title %]</a></td>
                  <td><div class="inline-block"><ins title="Изменить" class="sprite32bit size16x16 i16_edit clickable" onClick="load_dialog('[% C.uri_for_action('/mediaplan/edit', [mediaplan.id]) %]','d_mediaplan'); showDialog('d_mediaplan')" onMouseOver="Element.addClassName(this.parentNode.parentNode.parentNode,'over'); Element.addClassName(this,'i16_edit_over');" onMouseOut="Element.removeClassName(this,'i16_edit_over');  Element.removeClassName(this.parentNode.parentNode.parentNode,'over');"><i></i></ins><ins title="Удалить" class="sprite32bit size16x16 i16_del clickable" onClick="delete_object('[% C.uri_for_action('/mediaplan/delete', [mediaplan.id]) %]', 'Удалить «[% mediaplan.title %]» ?\n\n');" onMouseOver="Element.addClassName(this.parentNode.parentNode.parentNode,'over'); Element.addClassName(this,'i16_del_over');" onMouseOut="Element.removeClassName(this,'i16_del_over'); Element.removeClassName(this.parentNode.parentNode.parentNode,'over');"><i></i></ins></div></td>
                  <td class="numeric">[% mediaplan.min_date %] &#150; [% mediaplan.max_date %]</td>
                  <td>[% mediaplan.advertiser %]</td>
                  <td>[% mediaplan.sales_manager %]</td>
                  <td>[% mediaplan.account_manager %]</td>
                </tr>
                [% END %]
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

[% INCLUDE _inc/_dialogs %]
  </body>
</html>
