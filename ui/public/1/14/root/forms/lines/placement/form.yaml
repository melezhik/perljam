---
  method: POST
  attrs: { name: 'placementForm', class: 'inner mform' }
  output_processors: [ Indent ]
  auto_id: '%f_%n'
  languages: ru
  model_config:
    resultset: Line

  default_args:
    elements:
      Text:
        filters:
          - type: TrimEdges
      Select:
        constraints:
          - type: AutoSet
      Radiogroup:
        auto_id: '%f_%n_%c'

  constraints:
    - type: Required
      names: [title, priceProductId, bannerFormatId, priceType, startDate, adId, adType]

    - type: SingleValue
      names: [revision, title]

  inflators:
    - type: DateTime
      names: [ startDate, stopDate ]
      parser:
        strptime: '%Y-%m-%d'
      strptime:
        pattern: '%Y-%m-%d'
      locale: ru

  deflator:
    - type: Strftime
      names: [ startDate, stopDate ]
      strftime: '%Y-%m-%d'

  validators:
    - type: '+BampoManager::FormFu::Validator::Placement::Ad'
      name: adId
      message: "компания не существует"

    - type: '+BampoManager::FormFu::Validator::Placement::Profile'
      name: profileId
      message: "профайл не существует"

  elements:
    - type: Hidden
      name: revision
      default: 0

    - type: Hidden
      name: mediaplanId

    - type: Hidden
      name: type
      default: adAdriver

    - type: Text
      name: title
      label: "Название:"
      attrs: { class: 'wide', required: 1 }


    - type: Fieldset
      legend: Продукт и цена
      elements:
        - type: Select
          name: bannerFormatId
          label: "Формат баннера:"
          attrs: { class: 'wide', required: 1 }
          empty_first: 1
          empty_first_label: -- не назначен --
          model_config:
            resultset: BannerFormat
            label_column: title
            attributes: { order_by: [ 'title' ] }

        - type: Select
          name: priceProductId
          label: "Канал:"
          attrs: { class: 'wide', required: 1 }
          empty_first: 1
          empty_first_label: -- не назначен --
          model_config:
            resultset: Product
            label_column: title
            attributes: { order_by: [ 'title' ] }

        - type: Select
          name: channelGroupId
          label: "Группа каналов:"
          attrs: { class: 'wide', required: 1 }
          empty_first: 1
          empty_first_label: -- не назначен --
          model_config:
            resultset: ChannelGroup
            label_column: title
            attributes: { order_by: [ 'title' ] }

        - type: Select
          name: placementTargetingId
          label: "Настройка:"
          attrs: { class: 'wide', required: 1 }
          empty_first: 1
          empty_first_label: -- не назначен --
          model_config:
            resultset: PlacementTargeting
            label_column: title
            attributes: { order_by: [ 'title' ] }

        - type: Radiogroup
          container_tag: div
          label_tag: label
          label: "Тип цены:"
          name: priceType
          options:
            - [ CPM, 'показы' ]
            - [ CPC, 'клики' ]
            - [ RS, '50/50' ]
          attrs:
            required: 1

        - type: Text
          name: priceAmount
          label: "Количество:"
          attrs: { class: '' }
          constraint:
            - type: Integer
              message: "Поле должно быть целым не отрицательным значением"

        - type: Text
          name: pricePurchase
          label: "Цена покупки:"
          attrs: { class: '' }
          constraint:
            - type: Number
              message: "Поле должно быть числовым значением, разделитель - точка"

        - type: Select
          name: costsSourceId
          label: "Источник затрат:"
          attrs: { class: 'wide' }
          empty_first: 1
          empty_first_label: -- не назначен --
          model_config:
            resultset: CostsSource
            label_column: title
            attributes: { order_by: [ 'title' ] }


    - type: Fieldset
      id: fieldsetCosts
      legend: Внешние затраты
      elements:
        - type: Select
          name: costsAccountId
          label: "Клиент:"
          attrs: { class: 'wide', required: 1 }
          empty_first: 1
          empty_first_label: -- не назначен --

        - type: Select
          name: costsCampaignId
          label: "Кампания:"
          attrs: { class: 'wide', required: 1 }
          empty_first: 1
          empty_first_label: -- не назначен --

        - type: Text
          name: costsCampaignName
          label: "Название компании:"
          attrs: { class: 'wide', required: 1 }

        - type: Text
          name: costsPlacementName
          label: "Название размещения:"
          attrs: { class: 'wide', required: 1 }


    - type: Fieldset
      legend: Период действия
      elements:
        - type: Multi
          label: "Дата начала:"
          container_tag: div
          container_attributes:
            class: dropdown_input
            id: start_holder
          javascript: calendar('startDate', '', 0, null, 'start_holder');
          attrs: { required: 1 }
          elements:
            - name: startDate
              type: Hidden

        - type: Multi
          label: "Дата окончания:"
          container_tag: div
          container_attributes:
            class: dropdown_input
            id: stop_holder
          javascript: calendar('stopDate', '', 0, null, 'stop_holder');
          elements:
            - name: stopDate
              type: Hidden


    - type: Fieldset
      legend: Кампания в Адривере
      elements:
        - type: Text
          name: adId
          label: "adID:"
          attrs: { class: '', required: 1 }

        - type: Text
          name: profileId
          label: "profileID:"
          attrs: { class: '' }

        - type: Radiogroup
          container_tag: div
          label_tag: label
          label: "Тип:"
          name: adType
          default: simple
          options:
            - [ simple, 'обычная' ]
            - [ network, 'сетевая' ]
          attrs:
            required: 1

        - type: Textarea
          name: targeting
          label: "Таргетинги:"
          comment: Описание в свободной форме
          rows: 7
          attrs: { class: 'wide' }

