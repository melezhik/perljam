---
  method: POST
  attrs: { name: 'cpointForm', class: 'inner mform' }
  output_processors: [ Indent ]
  auto_id: '%f_%n'
  languages: [ ru ]
  model_config:
    resultset: Line

  default_args:
    elements:
      Text:
        filters:
          - type: TrimEdges
      Select:
        constraints:
          - type: AutoSet
      Radiogroup:
        auto_id: '%f_%n_%c'

  constraints:
    - type: Required
      names: [title, billingType, statType, url,  geoId, priceType, supercom, startDate]

    - type: AutoSet
      names: [geoId]

    - type: MinMaxFields
      name: siteZoneId
      others: leadPagesNum
      min: 0
      max: 1

    - type: Required
      name: priceSale
      when:
        field: billingType
        value: commercial

    - type: SingleValue
      names: [revision, title]

    - type: Integer
      names: [priceAmount, dailyAmount, clicksExpireDays]
      message: "Поле должно быть целым не отрицательным значением"

    - type: Number
      names: [priceSale, supercom, priceClient, profitability]
      message: "Поле должно быть числовым значением, разделитель - точка"

    - type: Range
      names: [supercom, profitability]
      min:  0
      max:  100

    - type: MinRange
      name: clicksExpireDays
      min: 1

    - type: Regex
      name: priceSale
      regex: '^(\+|-)?0+(.0|.00\d*)?$'
      not: 1
      when:
        field: billingType
        value: commercial

  inflators:
    - type: DateTime
      names: [ startDate, stopDate ]
      parser:
        strptime: '%Y-%m-%d'
      strptime:
        pattern: '%Y-%m-%d'
      locale: ru

  deflator:
    - type: Strftime
      names: [ startDate, stopDate ]
      strftime: '%Y-%m-%d'

  validators:
    - type: '+BampoManager::FormFu::Validator::CPoint::PriceType'
      name: priceType
      message: "ошибка в связанных полях"


  elements:
    - type: Hidden
      name: revision
      default: 0

    - type: Hidden
      name: mediaplanId

    - type: Hidden
      name: type
      default: sitePixel

    - type: Text
      name: title
      label: "Название:"
      attrs: { class: 'wide', required: 1 }

    - type: Radiogroup
      container_tag: div
      label_tag: label
      label: "Тип расчета:"
      name: billingType
      options:
        - [ test, 'тестовая' ]
        - [ commercial, 'коммерческая' ]
      attrs:
        required: 1

    - type: Radiogroup
      container_tag: div
      label_tag: label
      label: "Тип статистики:"
      name: statType
      default: own
      options:
        - [ own, 'собственная' ]
        - [ client, 'клиентская' ]
      attrs:
        required: 1

    - type: Checkbox
      name: sitePaid
      label: "Оплачиваемая:"


    - type: Fieldset
      legend: Сайт и зона сайта
      attrs: { class: 'site_sitezone' }
      elements:
        - type: Text
          name: url
          label: "URL:"
          attrs: { class: 'wide', required: 1 }

        - type: Text
          name: siteId
          label: "SiteID:"
          attrs: { class: '' }

        - type: Text
          name: siteZoneId
          label: "siteZoneID:"
          attrs: { class: '' }

        - type: Text
          name: leadPagesNum
          label: "Кол-во страниц:"
          attrs: { class: '' }


    - type: Fieldset
      legend: Продукт и цена
      elements:
        - type: Radiogroup
          container_tag: div
          label_tag: label
          label: "Тип цены:"
          name: priceType
          default: CPL
          options:
            - [ CPL, 'уникалы' ]
            - [ CPA, 'не уникалы' ]
            - [ CPV, 'охват' ]
            - [ CPC, 'клики' ]
            - [ CPM, 'CPM' ]
          attrs:
            required: 1

        - type: Text
          name: orderNumber
          label: "№ действия в заявке"
          attrs: { class: '' }
          model_config:
            null_if_empty: 1

        - type: Select
          name: geoId
          label: "География:"
          attrs: { class: 'wide', required: 1 }
          empty_first: 1
          empty_first_label: -- не назначен --
          model_config:
            resultset: Geo
            label_column: title
            attributes: { order_by: [ 'title' ] }

        - type: Text
          name: priceAmount
          label: "Количество лидов всего:"
          attrs: { class: '' }
          model_config:
            null_if_empty: 1

        - type: Text
          name: dailyAmount
          label: "Количество лидов в день:"
          attrs: { class: '' }
          model_config:
            null_if_empty: 1

        - type: Text
          name: priceSale
          label: "Цена продажи:"
          attrs: { class: '' }
          default: 0
          model_config:
            null_if_empty: 1

        - type: Text
          name: supercom
          label: "Суперкомиссия %:"
          attrs: { class: '', required: 1 }
          default: 0
          model_config:
            null_if_empty: 1

        - type: Text
          name: priceClient
          label: "Клиентская цена:"
          attrs: { class: '' }
          default: 0
          model_config:
            null_if_empty: 1

        - type: Text
          name: profitability
          label: "Рентабельность %:"
          attrs: { class: '' }
          default: 50
          model_config:
            null_if_empty: 1

        - type: Text
          name: clicksExpireDays
          label: "Период подсчёта кликов:"
          attrs: { class: '' }
          default: 30
          model_config:
            null_if_empty: 1


    - type: Fieldset
      legend: Период действия
      elements:
        - type: Multi
          label: "Дата начала:"
          container_tag: div
          container_attributes:
            class: dropdown_input
            id: start_holder
          attrs: { required: 1 }
          elements:
            - name: startDate
              type: Hidden
              attrs: { required: 1 }

        - type: Multi
          label: "Дата окончания:"
          container_tag: div
          container_attributes:
            class: dropdown_input
            id: stop_holder
          javascript: "initDateRange({elmValue: 'startDate', holder: '#start_holder'}, {elmValue: 'stopDate', holder: '#stop_holder'});"
          elements:
            - name: stopDate
              type: Hidden
              attrs: { data-reset-enable: 1 }
